<input
  type="hidden"
  [name]="name"
  [(ngModel)]="mXXfile"
/>
<div class="card {{ cardClass }}">
  @if (error) {
    <div class="card-header">
      <!-- show errors -->
      <div
        class="alert alert-danger form-text"
        role="alert"
      >
        <div
          class="d-block"
          [innerHtml]="error?.message | jfSafe: 'html'"
        ></div>
        <div class="d-block">
          <small [innerHtml]="error?.data?.message | jfSafe: 'html'"> {{ error?.data?.message }} </small>
        </div>
      </div>
      <!-- show errors .end -->
    </div>
  }

  <div class="card-body">
    <div
      class="modelFieldWrap position-relative overflow-hidden text-center"
      [style.min-height]="minHeight"
      [style.max-height]="maxHeight"
    >
      <img
        [src]="url2showStaticImage || (mXXfile | jfHasXFile: iWidth : iHeight : '?rCountry=' + labels.k.entityGlobalV)"
        class="img-fluid img-field {{ landscape }}"
      />

      <div
        class="dropzone position-absolute"
        ng2FileDrop
        [ngClass]="{hovering: hasBaseDropZoneOver}"
        (fileOver)="fileOverBase($event)"
        (onFileDrop)="dropped($event)"
        [uploader]="uploader"
      >
        <span>
          <b>{{ url2showStaticImage && mXXfile.nameOriginal && !allowMultiples ? mXXfile.nameOriginal : label }}</b>
        </span>
        <div class="file">
          <label class="file-label m-1">
            @if (allowMultiples) {
              <div>
                <input
                  type="file"
                  class="file-input no-firebase"
                  ng2FileSelect
                  multiple
                  [uploader]="uploader"
                />
              </div>
            } @else {
              <input
                type="file"
                class="file-input no-firebase"
                ng2FileSelect
                [uploader]="uploader"
              />
            }

            <span class="file-cta"> <i class="fa fa-upload"></i>o elige un archivo…</span>
          </label>
        </div>
      </div>

      @if (mXXfile.id > 0 && showDelete) {
        <a
          ngbTooltip="Borrar archivo"
          rel="noopener"
          (click)="onDelete(mXXfile)"
          class="position-absolute t-0 l-0 bg-primary cursor-pointer text-white"
        >
          <i class="fa fa-trash m-1"></i>
        </a>
      }

      @if (mXXfile.id > 0 && showPublicPath) {
        <a
          target="_blank"
          rel="noopener"
          [href]="mXXfile | jfHasXFile: iWidth : iHeight : '?rCountry=' + labels.k.entityGlobalV"
          class="position-absolute t-0 r-0 bg-primary text-white"
        >
          <i class="fa fa-eye m-1"></i>
        </a>
      }
    </div>
  </div>

  @if (maxFileSize || (!hideProcess && uploader?.queue?.length)) {
    <div class="card-footer">
      @if (maxFileSize) {
        <p class="text-center">Tamaño máximo de archivo: {{ maxFileSize / 1024 / 1024 | number: '.2' }} MB</p>
      }
      <!-- Subir a servidor -->
      @if (!hideProcess && uploader?.queue?.length) {
        <div class="row">
          <div class="col-12">
            <div class="position-realtive">
              <div class="position-absolute z-i-100 bg-white">
                <h3>Archivos en cola</h3>
                <p>Longitud de la cola: {{ uploader?.queue?.length }}</p>
                <table class="table-sm table-striped table-hover table">
                  <thead>
                    <tr>
                      <th>Nombre</th>
                      <th>Progreso</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (item of uploader.queue; track item) {
                      <tr>
                        <td>
                          <strong>{{ item?.file?.name }}</strong>
                          <p>{{ item?.file?.size / 1024 / 1024 | number: '.2' }} MB</p>
                          <p class="text-center">
                            @if (item.isSuccess) {
                              <span><i class="fa fa-check-circle"></i></span>
                            }
                            @if (item.isCancel) {
                              <span><i class="fa fa-ban"></i></span>
                            }
                            @if (item.isError) {
                              <span><i class="fa fa-exclamation-triangle"></i></span>
                            }
                          </p>
                        </td>
                        <td>
                          <div class="progress">
                            <div
                              class="progress-bar"
                              role="progressbar"
                              [ngStyle]="{width: item.progress + '%'}"
                            ></div>
                          </div>
                        </td>
                        <td>
                          <button
                            type="button"
                            class="btn btn-success btn-sm m-1"
                            (click)="item.upload()"
                            [disabled]="item.isReady || item.isUploading || item.isSuccess"
                          >
                            <span class="fa fa-upload"></span> Subir
                          </button>
                          <button
                            type="button"
                            class="btn btn-warning btn-sm m-1"
                            (click)="item.cancel()"
                            [disabled]="!item.isUploading"
                          >
                            <span class="fa fa-ban"></span> Cancelar
                          </button>
                          <button
                            type="button"
                            class="btn btn-danger btn-sm m-1"
                            (click)="item.remove()"
                          >
                            <span class="fa fa-trash"></span> Remover
                          </button>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
                <div>
                  <div>
                    Progreso:
                    <div class="progress">
                      <div
                        class="progress-bar"
                        role="progressbar"
                        [ngStyle]="{width: uploader.progress + '%'}"
                      ></div>
                    </div>
                  </div>
                  <button
                    type="button"
                    class="btn btn-success btn-sm m-1"
                    (click)="uploader.uploadAll()"
                    [disabled]="!uploader.getNotUploadedItems().length"
                  >
                    <span class="fa fa-upload"></span> Subir
                  </button>
                  <button
                    type="button"
                    class="btn btn-warning btn-sm m-1"
                    (click)="uploader.cancelAll()"
                    [disabled]="!uploader.isUploading"
                  >
                    <span class="fa fa-ban"></span> Cancelar
                  </button>
                  <button
                    type="button"
                    class="btn btn-danger btn-sm m-1"
                    (click)="uploader.clearQueue()"
                    [disabled]="!uploader.queue.length"
                  >
                    <span class="fa fa-trash"></span> Remover
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
